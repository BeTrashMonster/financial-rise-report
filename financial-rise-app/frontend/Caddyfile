# Caddy configuration for Financial RISE Frontend
# Serves React static files and proxies API requests to backend
# Automatic HTTPS with Let's Encrypt

{
    email admin@getoffthemoneyshametrain.com
}

getoffthemoneyshametrain.com {
    # Enable gzip compression
    encode gzip

    # Security headers
    header {
        # Prevent clickjacking
        X-Frame-Options "SAMEORIGIN"
        # Prevent MIME type sniffing
        X-Content-Type-Options "nosniff"
        # XSS protection
        X-XSS-Protection "1; mode=block"
        # Referrer policy
        Referrer-Policy "no-referrer-when-downgrade"
        # HSTS - force HTTPS
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        # Remove Server header
        -Server
    }

    # Handle API requests - proxy to backend
    @api path /api/*
    handle @api {
        reverse_proxy backend:3000
    }

    # Handle static files and SPA routing
    handle {
        root * /usr/share/caddy

        # Cache static assets (JS, CSS, images, fonts)
        @static {
            path *.js *.css *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2 *.ttf *.eot
        }
        header @static {
            Cache-Control "public, max-age=31536000, immutable"
        }

        # SPA routing - serve index.html for all routes that didn't match above
        try_files {path} /index.html
        file_server
    }
}

# Redirect www to non-www
www.getoffthemoneyshametrain.com {
    redir https://getoffthemoneyshametrain.com{uri} permanent
}
